- name: setup of redis
  hosts: redis
  become: yes

  tasks:
    - name: Install Redis
      ansible.builtin.dnf:
        name: redis
        state: present

    - name: Update redis listen address
      ansible.builtin.replace:
        path: /etc/redis/redis.conf
        regexp: '^bind\s+127\.0\.0\.1'
        replace: "bind 0.0.0.0"

    - name: Disable protected mode
      ansible.builtin.replace:
        path: /etc/redis/redis.conf
        regexp: '^protected-mode\s+yes'
        replace: "protected-mode no"

    - name: Enable and start redis service
      ansible.builtin.systemd:
        name: redis
        state: started
        enabled: yes
